<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>שליטה קולית - Voice Remote</title>
    <link rel="stylesheet" href="styles.css?v=2.10">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎤 שליטה קולית</h1>
            <p>שליטה במכשירים באמצעות קול</p>
        </header>

        <div class="main-content">
            <!-- אזור שליטה קולית -->
            <section class="voice-control">
                <div class="voice-status">
                    <button id="startListening" class="mic-btn">
                        <span class="mic-icon">🎤</span>
                        <span>התחל האזנה</span>
                    </button>
                    <div id="voiceFeedback" class="voice-feedback"></div>
                    <div id="transcript" class="transcript"></div>
                </div>
            </section>

            <!-- שלט רחוק ויזואלי -->
            <section class="remote-control-section">
                <h2>📱 שלט רחוק ויזואלי</h2>
                <div style="margin-bottom: 15px;">
                    <label>בחר מכשיר לשליטה:</label>
                    <select id="remoteDeviceSelect" style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd; margin-top: 10px;">
                        <option value="">-- בחר מכשיר --</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="downloadRemoteGUI" class="btn-secondary" style="flex: 1; min-width: 150px;">
                        🌐 הורד GUI מקורי
                    </button>
                    <button id="uploadRemoteImage" class="btn-secondary" style="flex: 1; min-width: 150px;">
                        📤 העלה תמונת שלט
                    </button>
                    <button id="searchRemoteOnline" class="btn-secondary" style="flex: 1; min-width: 150px;">
                        🔍 חפש שלט באינטרנט
                    </button>
                </div>
                <div id="visualRemote" class="visual-remote-container" style="display: none;">
                    <div class="visual-remote">
                        <!-- כותרת מכשיר -->
                        <div class="remote-header" style="text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid rgba(255,255,255,0.3);">
                            <h3 id="remoteDeviceName" style="color: white; font-size: 1.5em; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);"></h3>
                            <div id="remoteDeviceType" style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 5px;"></div>
                        </div>

                        <!-- מספרים -->
                        <div class="remote-numbers">
                            <button class="remote-btn number-btn" data-command="1">1</button>
                            <button class="remote-btn number-btn" data-command="2">2</button>
                            <button class="remote-btn number-btn" data-command="3">3</button>
                            <button class="remote-btn number-btn" data-command="4">4</button>
                            <button class="remote-btn number-btn" data-command="5">5</button>
                            <button class="remote-btn number-btn" data-command="6">6</button>
                            <button class="remote-btn number-btn" data-command="7">7</button>
                            <button class="remote-btn number-btn" data-command="8">8</button>
                            <button class="remote-btn number-btn" data-command="9">9</button>
                            <button class="remote-btn number-btn" data-command="0">0</button>
                        </div>

                        <!-- ניווט -->
                        <div class="remote-navigation">
                            <button class="remote-btn nav-btn" data-command="up">⬆️</button>
                            <div class="nav-middle">
                                <button class="remote-btn nav-btn" data-command="left">⬅️</button>
                                <button class="remote-btn nav-btn" data-command="ok">OK</button>
                                <button class="remote-btn nav-btn" data-command="right">➡️</button>
                            </div>
                            <button class="remote-btn nav-btn" data-command="down">⬇️</button>
                        </div>

                        <!-- בקרות -->
                        <div class="remote-controls">
                            <button class="remote-btn power-btn power-on-btn" data-command="power_on">🟢 הדלק</button>
                            <button class="remote-btn power-btn power-off-btn" data-command="power_off">🔴 כבה</button>
                            <button class="remote-btn" data-command="volume_up">🔊 +</button>
                            <button class="remote-btn" data-command="volume_down">🔉 -</button>
                            <button class="remote-btn" data-command="mute">🔇 השתק</button>
                            <button class="remote-btn" data-command="channel_up">📺 +</button>
                            <button class="remote-btn" data-command="channel_down">📺 -</button>
                        </div>

                        <!-- תכונות נוספות -->
                        <div class="remote-features">
                            <button class="remote-btn" data-command="menu">📋 תפריט</button>
                            <button class="remote-btn" data-command="back">↩️ חזור</button>
                            <button class="remote-btn" data-command="home">🏠 בית</button>
                            <button class="remote-btn" data-command="info">ℹ️ מידע</button>
                            <button class="remote-btn" data-command="settings">⚙️ הגדרות</button>
                            <button class="remote-btn" data-command="exit">❌ יציאה</button>
                        </div>

                        <!-- כפתורים ספציפיים למכשיר -->
                        <div id="deviceSpecificButtons" class="remote-device-specific"></div>
                    </div>
                </div>
            </section>

            <!-- ניהול מכשירים -->
            <section class="devices-section">
                <h2>מכשירים</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button id="addDeviceBtn" class="btn-primary">+ הוסף מכשיר</button>
                    <button id="autoScanBtn" class="btn-secondary" onclick="startAutoScan()">🔍 סריקה אוטומטית (כל החיבורים)</button>
                    <button class="btn-secondary" onclick="autoScanWiFi()">📶 סריקת WiFi</button>
                    <button class="btn-secondary" onclick="autoScanBluetooth()">🔵 סריקת Bluetooth</button>
                    <button class="btn-secondary" onclick="autoScanUSB()">🔌 סריקת USB</button>
                    <button class="btn-secondary" onclick="autoScanIR()">🔴 סריקת IR</button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="saveDevicesToFile()">💾 שמור מכשירים</button>
                    <button class="btn-primary" onclick="loadDevicesFromFile()">📂 טען מכשירים</button>
                    <button class="btn-secondary" onclick="exportDevices()">📤 ייצא מכשירים</button>
                    <button class="btn-secondary" onclick="importDevices()">📥 ייבא מכשירים</button>
                </div>
                <div id="devicesList" class="devices-list"></div>
            </section>

            <!-- סצנות קבועות -->
            <section class="scenes-section">
                <h2>🎬 סצנות קבועות</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button id="addSceneBtn" class="btn-primary">+ צור סצנה חדשה</button>
                    <button class="btn-primary" onclick="saveScenesToFile()">💾 שמור סצנות</button>
                    <button class="btn-primary" onclick="loadScenesFromFile()">📂 טען סצנות</button>
                    <button class="btn-secondary" onclick="exportScenes()">📤 ייצא סצנות</button>
                    <button class="btn-secondary" onclick="importScenes()">📥 ייבא סצנות</button>
                </div>
                <div id="scenesList" class="devices-list"></div>
            </section>

            <!-- סריקת IR -->
            <section class="ir-scan-section">
                <h2>סריקת אינפרא אדום</h2>
                <div class="ir-controls">
                    <button id="startIRScan" class="btn-secondary">🔍 התחל סריקה</button>
                    <button id="stopIRScan" class="btn-secondary" style="display:none;">⏹ עצור סריקה</button>
                    <div id="irStatus" class="status-message"></div>
                </div>
                <!-- מחוון קליטת IR -->
                <div class="ir-indicators" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
                    <div class="ir-indicator-container" style="display: flex !important; visibility: visible !important;">
                        <div class="ir-indicator-label">📥 קליטה</div>
                        <div id="irReceiveIndicator" class="ir-indicator receive-indicator" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
                            <div class="ir-indicator-light" style="display: block !important; visibility: visible !important; opacity: 1 !important;"></div>
                        </div>
                    </div>
                    <div class="ir-indicator-container" style="display: flex !important; visibility: visible !important;">
                        <div class="ir-indicator-label">📤 שידור</div>
                        <div id="irSendIndicator" class="ir-indicator send-indicator" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
                            <div class="ir-indicator-light" style="display: block !important; visibility: visible !important; opacity: 1 !important;"></div>
                        </div>
                    </div>
                </div>
                <div id="irButtons" class="ir-buttons"></div>
            </section>

            <!-- הגדרות התחברות -->
            <section class="connection-section">
                <h2>התחברויות</h2>
                <div class="connection-tabs">
                    <button class="tab-btn active" data-tab="wifi">WiFi</button>
                    <button class="tab-btn" data-tab="bluetooth">Bluetooth</button>
                    <button class="tab-btn" data-tab="usb">USB</button>
                    <button class="tab-btn" data-tab="qr">QR Code</button>
                    <button class="tab-btn" data-tab="auto">זיהוי אוטומטי</button>
                    <button class="tab-btn" data-tab="ir">IR</button>
                </div>
                <div id="connectionContent" class="connection-content">
                    <div class="tab-panel active" id="wifi-panel">
                        <h3>WiFi</h3>
                        <input type="text" id="wifiSSID" placeholder="שם רשת WiFi">
                        <input type="password" id="wifiPassword" placeholder="סיסמה">
                        <button class="btn-primary" onclick="connectWiFi()">התחבר</button>
                        <div id="wifiStatus" class="status-message"></div>
                    </div>
                    <div class="tab-panel" id="bluetooth-panel">
                        <h3>Bluetooth</h3>
                        <button class="btn-primary" onclick="scanBluetooth()">סרוק מכשירים</button>
                        <div id="bluetoothDevices" class="devices-list"></div>
                        <div id="bluetoothStatus" class="status-message"></div>
                    </div>
                    <div class="tab-panel" id="usb-panel">
                        <h3>USB</h3>
                        <p>התחבר למכשיר IR דרך USB</p>
                        <button class="btn-primary" onclick="connectUSB()">🔌 התחבר למכשיר USB</button>
                        <button class="btn-secondary" onclick="disconnectUSB()" id="disconnectUSBBtn" style="display:none;">❌ נתק</button>
                        <div id="usbStatus" class="status-message"></div>
                        <div id="usbDeviceInfo" class="device-info" style="display:none;">
                            <h4>מכשיר מחובר:</h4>
                            <div id="usbDeviceDetails"></div>
                        </div>
                    </div>
                    <div class="tab-panel" id="qr-panel">
                        <h3>📱 QR Code</h3>
                        <p>סרוק QR Code מהמכשיר שלך</p>
                        <button class="btn-primary" onclick="scanQRCode()" id="startQRScanBtn">📷 סרוק QR Code</button>
                        <button class="btn-secondary" onclick="stopQRScanning()" id="stopQRScanBtn" style="display:none;">⏹ עצור סריקה</button>
                        <div id="qrPreview" style="margin: 20px 0; text-align: center; display: none;">
                            <video id="qrVideo" width="300" height="300" style="border-radius: 10px; display: none;"></video>
                            <canvas id="qrCanvas" style="display: none;"></canvas>
                        </div>
                        <input type="text" id="qrCodeInput" placeholder="או הזן קוד QR ידנית" style="width: 100%; margin-top: 10px; padding: 12px; border-radius: 8px; border: 2px solid #ddd;">
                        <button class="btn-secondary" onclick="connectQRCode()" style="margin-top: 10px;">התחבר עם קוד</button>
                        <div id="qrStatus" class="status-message"></div>
                    </div>
                    <div class="tab-panel" id="auto-panel">
                        <h3>🤖 זיהוי אוטומטי</h3>
                        <p>זיהוי אוטומטי של מכשירים ברשת</p>
                        <button class="btn-primary" onclick="autoDetectDevices()">🔍 התחל זיהוי אוטומטי</button>
                        <div id="autoDetectStatus" class="status-message"></div>
                        <div id="autoDetectedDevices" class="devices-list" style="margin-top: 20px;"></div>
                    </div>
                    <div class="tab-panel" id="ir-panel">
                        <h3>IR (אינפרא אדום)</h3>
                        <p>התחבר למכשיר IR דרך USB או Bluetooth</p>
                        <button class="btn-primary" onclick="connectIR()">התחבר למכשיר IR</button>
                        <div id="irConnectionStatus" class="status-message"></div>
                    </div>
                </div>
            </section>

            <!-- טמפלטים מוכנים -->
            <section class="templates-section">
                <h2>📋 טמפלטים מוכנים</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <input type="text" id="templateSearch" placeholder="🔍 חיפוש טמפלט..." style="flex: 1; min-width: 200px; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                    <select id="templateCategoryFilter" style="padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                        <option value="">כל הקטגוריות</option>
                        <option value="tv">📺 טלוויזיות</option>
                        <option value="ac">❄️ מזגנים</option>
                        <option value="audio">🔊 מערכות שמע</option>
                        <option value="light">💡 תאורה</option>
                        <option value="streamer">📱 סטרימרים</option>
                        <option value="camera">📷 מצלמות</option>
                        <option value="fan">🌀 מאווררים</option>
                        <option value="blinds">🪟 תריסים</option>
                        <option value="door">🚪 דלתות</option>
                        <option value="security">🔒 אבטחה</option>
                        <option value="heater">🔥 תנורים</option>
                        <option value="projector">📽️ מקרנים</option>
                        <option value="smart_hub">🏠 Smart Hubs</option>
                    </select>
                    <button class="btn-primary" onclick="loadAllTemplates()">🔄 רענן טמפלטים</button>
                </div>
                <div id="templatesList" class="devices-list"></div>
            </section>
        </div>
    </div>

    <!-- מודל יצירת סצנה -->
    <div id="sceneModal" class="modal">
        <div class="modal-content">
            <span class="close-scene">&times;</span>
            <h2>🎬 צור סצנה חדשה</h2>
            <form id="sceneForm">
                <label>שם סצנה:</label>
                <input type="text" id="sceneName" placeholder="למשל: סלון, שינה, עבודה" required>

                <label>תיאור:</label>
                <input type="text" id="sceneDescription" placeholder="תיאור קצר של הסצנה">

                <label>בחר מכשירים לסצנה:</label>
                <div id="sceneDevicesList" style="max-height: 200px; overflow-y: auto; border: 2px solid #ddd; border-radius: 8px; padding: 10px; margin: 10px 0;">
                    <!-- יטען דינמית -->
                </div>

                <label>פעולות לכל מכשיר:</label>
                <div id="sceneActionsList" style="max-height: 300px; overflow-y: auto; border: 2px solid #ddd; border-radius: 8px; padding: 10px; margin: 10px 0;">
                    <!-- יטען דינמית -->
                </div>

                <button type="submit" class="btn-primary">שמור סצנה</button>
            </form>
        </div>
    </div>

    <!-- מודל הוספת מכשיר -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>הוסף מכשיר חדש</h2>
            <form id="deviceForm">
                <label>שם מכשיר:</label>
                <input type="text" id="deviceName" required>

                <label>סוג מכשיר:</label>
                <select id="deviceType" required>
                    <option value="tv">📺 טלוויזיה</option>
                    <option value="ac">❄️ מזגן</option>
                    <option value="audio">🔊 מערכת שמע</option>
                    <option value="light">💡 תאורה</option>
                    <option value="streamer">📱 סטרימר (Apple TV, Chromecast)</option>
                    <option value="camera">📷 מצלמה</option>
                    <option value="fan">🌀 מאוורר</option>
                    <option value="blinds">🪟 תריסים</option>
                    <option value="door">🚪 דלתות</option>
                    <option value="security">🔒 מערכת אבטחה</option>
                    <option value="heater">🔥 תנור</option>
                    <option value="projector">📽️ מקרן</option>
                    <option value="smart_hub">🏠 Smart Hub</option>
                    <option value="other">⚙️ אחר</option>
                </select>

                <label>סוג התחברות:</label>
                <select id="connectionType" required>
                    <option value="ir">🔴 IR (אינפרא אדום)</option>
                    <option value="wifi">📶 WiFi</option>
                    <option value="bluetooth">🔵 Bluetooth</option>
                    <option value="usb">🔌 USB</option>
                    <option value="qr">📱 QR Code</option>
                    <option value="auto">🤖 זיהוי אוטומטי</option>
                    <option value="code">🔢 קוד מספרי</option>
                    <option value="nfc">📲 NFC</option>
                </select>

                <label>כתובת IP (אם WiFi):</label>
                <input type="text" id="deviceIP" placeholder="192.168.1.1">

                <label>קוד QR או מספר (אם QR/Code):</label>
                <input type="text" id="deviceCode" placeholder="QR Code או קוד מספרי">

                <label>זיהוי אוטומטי:</label>
                <input type="checkbox" id="autoDetect"> אפשר זיהוי אוטומטי

                <button type="submit" class="btn-primary">שמור</button>
            </form>
        </div>
    </div>

    <!-- מודל הורדת/חיפוש GUI של שלט -->
    <div id="remoteGUIModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="document.getElementById('remoteGUIModal').style.display='none'">&times;</span>
            <h2>🌐 הורד GUI של שלט מקורי</h2>
            <div id="remoteGUIContent">
                <div style="margin-bottom: 20px;">
                    <label>חיפוש שלט:</label>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <input type="text" id="remoteSearchQuery" placeholder="לדוגמה: Samsung TV remote, LG air conditioner remote" style="flex: 1; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
                        <button id="searchRemoteBtn" class="btn-primary">🔍 חפש</button>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label>או העלה תמונת שלט:</label>
                    <input type="file" id="remoteImageUpload" accept="image/*" style="width: 100%; padding: 10px; margin-top: 10px;">
                    <div id="remoteImagePreview" style="margin-top: 15px; text-align: center; display: none;">
                        <img id="previewRemoteImage" style="max-width: 100%; max-height: 400px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                    </div>
                </div>
                <div id="remoteSearchResults" style="margin-top: 20px;"></div>
                <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                    <h3>💡 טיפים:</h3>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li>חפש תמונות של שלטים באתרים כמו: Google Images, Amazon, או אתרי היצרנים</li>
                        <li>תמונות עם רזולוציה גבוהה יעבדו טוב יותר</li>
                        <li>אחרי העלאת התמונה, תוכל לסמן אזורי לחיצה על הכפתורים</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js?v=2.10"></script>
</body>
</html>

